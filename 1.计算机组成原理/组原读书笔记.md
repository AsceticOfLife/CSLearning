

# 总结

日期：2023.4.23~2023.5.6（14天左右）

缺第六章没读。（计算机的运算方法）

对于计算机五大模块组成计算机有了更深的理解。

对于各个模块如何工作也有了更深的认识。

对于后序学习操作系统、汇编语言有很大帮助。

# 第一章 概述

主要是从计算机的组成上概述。

第一节主要内容有软件和硬件的基本概念、计算机的抽象层次（从下向上为微指令机器m0、机器语言机器m1、操作系统机器m2、汇编语言机器m3、高级语言机器m4）、计算机体系结构和组成的区别。

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\1-1-1.png" alt="image-20230505091621925" style="zoom:67%;" />

第二节主要内容有：冯诺依曼计算机结构（以运算器为核心）、现代计算机结构（以存储器为核心）、组成为存储器、控制器、运算器、IO设备，其中需要注意的理解的概念是存储单元，存储基元是1bit，存储单元是存储基元的集合体，长度成为存储字长，可以是8、16、32位。还需要理解指令，指令由操作码和地址码构成，操作码说明应该进行何种操作，地址码说明去存储器的哪个位置取内容（指令或者数据）。

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\1-2-1.png" alt="image-20230505091716122" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\1-2-2.png" alt="image-20230505091748479" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\1-2-3.png" alt="image-20230505091809529" style="zoom:67%;" />

接着以一个问题例子说明计算机如何解决问题，解决问题需要把问题建模成计算机能够处理的问题，**计算机能够处理的就是算术运算和逻辑运算**。

以这个例子详细说明五大器件，主要是说明运算器、控制器、存储器。

1.存储器与MAR和MDR相连，其中：MAR（内存地址寄存器）：表示到内存的位置索引，其位长表示存储器由多少个存储单元；MDR（内存数据寄存器）：将从内存中取出或者准备放进去的指令暂时保存（即从内存中取出的内容），长度位存储基元长度。

2.算术逻辑单元（ALU）和至少三个寄存器（现代计算机时通用寄存器，不分类）：ACC：累加器，保存准备要计算的数据和计算结果；MQ：乘商寄存器，在乘法和除法时保存一部分结果数据；X：保存操作数。

3.控制器：由程序计数器（PC）、指令寄存器（IR）、控制单元（CU）组成，其中：PCR：保存指令在内存中的位置，自动加1；指令寄存器：将操作码交给分析器，将地址码输入到MAR，准备从存储器中取内容；控制单元（CU）：分析需要进行和何种操作。因此，一个指令周期包括：取指周期、分析周期、执行周期。



# 第二章 发展（跳过）

# 第三章 系统总线

第一节的主要内容是介绍总线的基本概念，即用于五大器件之间传输信号的线；以及基本的结构中的总线布局。

第二节主要是总线的基本分类，大致上可以分为片内、系统和通信，其中片内是指cpu内部的线，通信总线是计算机系统与系统之间的线路。重点是系统总线，系统总线可以分为数据、地址、控制总线，其中数据总线是用于传输数据的，双向传输线，比如存储器和cpu之间，该总线位数与存储单元位数（存储字长）和机器字长有关，类似于MDR；地址总线是指令在存储器（或者IO设备）中的地址，是单向传输线，其个数与存储器有多少个存储单元有关，类似于MAR；控制总线是发送控制信号。

第三节总线特性中需要知道总线指标有总线数目、总线传输速率。

第四节总线结构，单总线结构不适用于中大型系统，多总线结构设计的主要原则是把速度相近的器件相连，分成多个层次，不同层次之间的总线再通过桥相连，以及层次之间还需要一个总线控制器。

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\3-4-1.png" alt="image-20230505090819171" style="zoom:50%;" />

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\3-4-2.png" alt="image-20230505090848131" style="zoom:50%;" />

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\3-4-3.png" alt="image-20230505090934049" style="zoom:50%;" />

第五节总线控制，分为判优控制和通信控制。其中判优控制主要是决定总线上谁应该获得总线控制权，分为集中式和分离式。主要讲集中式，是指将逻辑交给一个中心比如CPU来判定谁应该具有控制权。分为三种：1.链式查询：即只需三条线，BS（总线忙）、BR（总线请求，向总线）、BR（总线同意，把权限给谁），每个器件都挂在这三条线上，需要通过监听BS、BR向中心申请使用权，中心通过BG分配权限，因此越靠近中心的器件优先级越高。2.计数器定时查询：少了BG线，每个设备挂在设备线上，通过计数器指定应该哪个设备使用。3.独立请求方式：每个元器件都有自己的BR、BG，向中心申请，中心内部决定给谁。

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\3-5-1.png" alt="image-20230505091029973" style="zoom:50%;" />

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\3-5-2.png" alt="image-20230505091051451" style="zoom:50%;" />

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\3-5-3.png" alt="image-20230505091108593" style="zoom:50%;" />

通信控制指的是一个总线操作期间如何使用总线，有4种方式：1.同步方式：即主模块和从模块都使用系统时钟，主模块在一个时钟上沿发出指令，从模块必须在规定时间内做出反应。因此需要根据最慢的元器件设计指令周期，不灵活；

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\3-5-4.png" alt="image-20230505091252863" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\3-5-5.png" alt="image-20230505091356092" style="zoom:67%;" />

2.异步方式：这里包括一个异步方式主模块和从模块如何建立“通信连接”，主要有不互锁、半互锁以及全互锁，大概就是握手的次数，对应不握手、主模块等待握手、主模块握手之后从模块等待握手。异步方式就是以一个低电平作为发送数据起点，中间是数据位、以及检错位，最后以一个、一个半、两个高电平作为发送终点。这里需要注意一个波特率和比特率的概念，简单来说就是波特率包含非数据位（有效位）。

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\3-5-6.png" alt="image-20230505091433775" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\3-5-7.png" alt="image-20230505091507501" style="zoom:67%;" />

3.半同步方式：与同步方式基本一致，就是如果从模块没有准备好就设置一个信号，当主模块发现这个信号就推迟到下一个时钟周期。

4.分离式通信：主要思想是把一个时钟周期分成两个，前半段主模块把指令发送完了之后不要再占用总线控制权，然后从模块接收到信号之后再申请使用总线，就是所有模块都成了主模块。



# 第四章 存储器

存储器保存指令和数据的元件。

## 概述

主要有两部分内容：存储器分类和存储器层次结构。

关于**存储器分类**，如果以存储介质分类可以分成半导体、磁表面存储器、磁芯、光盘，其中只有第一种是易失性。

如果以存取方式分类可以分成随机存储器（包括RAM和ROM）、顺序存储器和直接存取存储器（存取时间与物理地址有关）。

关于**层次结构**，从高到底为寄存器、缓存、主存、辅存（磁盘、光盘、磁带），其中最主要的层次结构是：

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\4-1-1.png" alt="image-20230506085155850" style="zoom:50%;" />

## 主存

主要内容包括概述（主存的基本结构、主存和CPU的关系、主存中存储单元的分配、主存技术指标）、半导体存储器介绍（基本结构、译码方式、RAM静态和动态、ROM）、存储器和CPU的连接、存储器校验（汉明码）、提高访存速度方法。

基本结构

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\4-1-2.png" alt="image-20230506085316399" style="zoom: 50%;" />

主存和CPU的关系：

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\4-2-1.png" alt="image-20230506085433752" style="zoom:67%;" />

主存存储地址的分配：

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\4-2-2.png" alt="image-20230506085947298" style="zoom:50%;" />

主存技术指标包括存储容量、存储速度（存储时间和存储周期）、存储器带宽

**半导体存储芯片的基本结构**：

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\4-2-3.png" alt="image-20230506090339993" style="zoom:50%;" />

**译码驱动方式：**

1.线选法：一维，如果CPU有10根地址线，就需要2^10根地址线，每根连接一个存储单元

2.重合法：二维，如果CPU有10根地址线，可以采用行32*列32根线选中一位。

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\4-2-4.png" alt="image-20230506090457257" style="zoom:50%;" />

**静态RAM：**

1.基本结构：

6MOS管组成的触发器

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\4-2-5.png" alt="image-20230506090553500" style="zoom:50%;" />

2.读写时序

**动态RAM：**

1.基本结构

3管MOS（使用电容存储，因此需要刷新）或者单管MOS

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\4-2-6.png" alt="image-20230506090717991" style="zoom:50%;" />

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\4-2-7.png" alt="image-20230506090739276" style="zoom:50%;" />

2.读写时序

3.刷新方法（按行刷新，刷新间隔小于2ms）

集中刷新：就是在一段时间内进行集中刷新，比如使用128个读写周期进行刷新，每个存取周期为0.2微秒，4000个周期是2ms，所以128个周期内无法进行读写。

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\4-2-8.png" alt="image-20230506090856993" style="zoom:50%;" />

分散刷新：

将一个存取周期分成读写和刷新

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\4-2-9.png" alt="image-20230506091149737" style="zoom:50%;" />

异步刷新：每隔一段时间刷新一行

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\4-2-10.png" alt="image-20230506091234393" style="zoom:50%;" />

**只读存储器：**

掩膜ROM：行列交叉处是否有MOS管（1或0）

PROM：熔丝断或者未断区分是1或者0

...

**存储器与CPU的连接：**

1.存储器扩展

位扩展：扩展存储字长，数据线低位是一个存储器，高几位是一个存储器，工作时所有存储芯片同时工作

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\4-2-12.png" alt="image-20230506091758454" style="zoom:50%;" />

字扩展：增加存储字的数量，修改地址线，使得不同信号选中不同的存储芯片

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\4-2-11.png" alt="image-20230506091735435" style="zoom:50%;" />

**存储器与CPU连接：**

需要思考的就是片选信号的生成。

书上有例题。

**存储器的校验：汉明码**

插入固定的位用于检测固定的位。

**提高访存的措施：**

1.单体多字：一次从主存种读取多个存储字。

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\4-2-13.png" alt="image-20230506092235257" style="zoom:50%;" />

2.多体并行

高位交叉编址：

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\4-2-14.png" alt="image-20230506092344876" style="zoom: 50%;" />

低位交叉编址：

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\4-2-15.png" alt="image-20230506092422496" style="zoom:50%;" />

区别在于：

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\4-2-16.png" alt="image-20230506092459789" style="zoom:50%;" />

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\4-2-17.png" alt="image-20230506092532813" style="zoom:67%;" />

## 高速缓冲存储器

主要包括工作原理、基本结构、主存和cache的地址映射、替换算法

**工作原理：**

主存中的块与cache中的块对应

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\4-3-2.png" alt="image-20230506092804891" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\4-3-1.png" alt="image-20230506092657022" style="zoom:50%;" />

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\4-3-3.png" alt="image-20230506092911000" style="zoom: 67%;" />

cache容量越大越好，但是达到一定容量之后命中提高就不明显。

cache块长的设计并不是越大越好，

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\4-3-4.png" alt="image-20230506093119724" style="zoom:67%;" />

**cache的基本结构：**

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\4-3-5.png" alt="image-20230506093152365" style="zoom: 50%;" />

cache存储体

地址映射变换机构：将CPU送来的主存地址转换为cache地址。

替换机构：cache内容满时选择替换哪一块，

cache读写操作：读很容易，写分为写直达法（写操作即写cache又写内存）、写回法（只写cache，当被替换时才写内存）

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\4-3-6.png" alt="image-20230506093528382" style="zoom: 50%;" />

**cache的改进:**

1.二级缓存

2.分立缓存（数据和指令不同）

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\4-3-7.png" alt="image-20230506093728806" style="zoom:50%;" />

**主存和cache映射：**

1.直接映射：

采用mod的方法，即cache从0~最大块与主存的一一对应，然后接着再从0开始一一对应。

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\4-3-8.png" alt="image-20230506093815506" style="zoom:50%;" />

2.全相联映射

cache的任何块都可以与主存的任何块对应。

3.组相联映射

cache分组，每一组中包含多个块，组与主存进行直接映射，组内与主存的块全相联映射。

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\4-3-9.png" alt="image-20230506094121722" style="zoom:50%;" />

例题：

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\4-3-10.png" alt="image-20230506094210293" style="zoom:50%;" />

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\4-3-11.png" alt="image-20230506094233584" style="zoom:50%;" />

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\4-3-12.png" alt="image-20230506094254579" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\4-3-13.png" alt="image-20230506094533470" style="zoom:67%;" />

**替换策略：**

1.先进先出

2近期最少使用

3.随机

## 辅存

做了解

**循环冗余校验码**

<img src="C:\Users\10985\AppData\Roaming\Typora\typora-user-images\image-20230506094730447.png" alt="image-20230506094730447" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\4-3-14.png" alt="image-20230506094741076" style="zoom:50%;" />

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\4-3-15.png" alt="image-20230506094758391" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\4-3-16.png" alt="image-20230506094824243" style="zoom:67%;" />

# 第五章 输入输出系统

## 概述

**发展阶段：**

1.IO设备输入输出必须经过CPU的控制

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\5-1-1.png" alt="image-20230506155617704" style="zoom: 67%;" />

2.接口模块和DMA模块

计算机采用总线结构，IO设备通过接口连接在总线上

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\5-1-2.png" alt="image-20230506155741774" style="zoom:67%;" />

DMA是在IO设备与存储器之间有数据通路，数据交换不通过CPU

3.具有通道结构的阶段

通道具有自己的指令，CPU发出启动通道指令后通道可以作为CPU的协助处理器管理IO设备

4.具有IO处理机的阶段

IO处理机独立于CPU工作。

**输入输出系统的组成：**

IO软件和IO硬件

软件部分：主要用IO指令和通道指令完成。

IO指令是机器指令的一种，一般格式为操作码+命令码+地址码。

通道指令是通道自身的指令。CPU通过IO指令启动通道，数据传送等任务由通道通过通道指令设计的通道程序完成。

硬件部分：一个通道可以和一个以上的设备控制器相连接，一个设备控制器可以连接多个类型相同的设备。

**IO设备与主机的联系方式：**

1.IO设备编址方式：既可以采用统一编码（即与主存地址编码一样，多出来的部分作为IO设备地址），也可以采用不统一编址（这样就必须使用与访存不同的指令）

当设备通过接口与主机相连时，可以通过接口地址访问设备。

2.设备寻址：根据设备号寻址。

3.传送方式：串行和并行。

4.联络方式：CPU需要知道IO设备的状态。立即响应、异步工作采用应答信号联络、同步工作采用同步时标联络。

5.连接方式有辐射式和总线式。

**IO设备与主机的控制方式：**

1.程序查询方式；2.程序中断方式；3.DMA方式

## IO设备介绍（略）

## IO接口

**总线连接的接口电路：**

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\5-3-1.png" alt="image-20230506161542912" style="zoom:67%;" />

1.数据线：IO设备与主机之间数据的传送线

2.设备选择线：传送设备码，根数取决于设备码的位数。

3.命令线：CPU向IO设备发送的命令信号。

4.状态线：IO设备向主机报告状态。

**接口的功能和组成：**

1.选址功能：选择哪台设备，SEL是设备选中信号。

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\5-3-2.png" alt="image-20230506161819957" style="zoom: 67%;" />

2.传送命令功能：

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\5-3-3.png" alt="image-20230506161921230" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\5-3-4.png" alt="image-20230506161943576" style="zoom:67%;" />

3.传送数据功能：通常具有数据缓冲寄存器，暂存IO设备与主机交换的数据。

4.反映IO状态的功能：具有反映IO设备状态的触发器。

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\5-3-5.png" alt="image-20230506162206367" style="zoom:67%;" />

## 程序查询方式

CPU不断查询IO设备状态是否准备好。

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\5-4-1.png" alt="image-20230506162240859" style="zoom: 80%;" />

**程序查询方式的接口电路：**

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\5-4-2.png" alt="image-20230506162405389" style="zoom:67%;" />

## 程序中断方式

**中断：**

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\5-5-1.png" alt="image-20230506162535989" style="zoom:67%;" />

**程序中断方式的接口电路：**

中断请求触发器INTR：表示发出中断请求

中断屏蔽触发器MASK：表示该设备被屏蔽

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\5-5-2.png" alt="image-20230506162658934" style="zoom:80%;" />

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\5-5-3.png" alt="image-20230506162726180" style="zoom:67%;" />

排队器：确定中断请求优先级，下面是链式排队器示意图

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\5-5-5.png" alt="image-20230506162824008" style="zoom:67%;" />

只要前面的INTR为1，后面INTP都为0。

中断向量地址形成部件：不同的设备有不同的中断服务程序，因此需要找到这个程序入口。使用中断向量找到中断程序入口地址：、

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\5-5-6.png" alt="image-20230506163028372" style="zoom:67%;" />

**程序中断方式接口电路基本组成**：

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\5-5-7.png" alt="image-20230506163155247" style="zoom: 50%;" />

**IO中断处理流程：**

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\5-5-8.png" alt="image-20230506163308034" style="zoom:67%;" />

**中断服务程序流程：**

保护现场：保存程序断点以及CPU寄存器内容

中断服务：不同中断服务程序不同

恢复现场

中断返回：返回之前程序执行的断点处

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\5-5-9.png" alt="image-20230506163536341" style="zoom:67%;" />

单重中断和多重中断的区别就是开中断的时间不同。

**程序中断方式下CPU效率提高：**

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\5-5-10.png" alt="image-20230506163634420" style="zoom:67%;" />

## DMA方式

DMA方式主要是在IO设备与主存之间增加一条数据通络，由DMA接口控制：

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\5-6-1.png" alt="image-20230506163823702" style="zoom:67%;" />

DMA与CPU访存冲突时，一般是DMA优先使用主存。

1.停止CPU访问主存；2.周期挪用（当DMA访问主存时占用几个主存存取周期，适用于IO涉笔读写周期大于主存周期）；3.DMA与CPU交替访问（CPU周期比主存周期长时，主存读写周期前一部分留给CPU，后一部分留给DMA）

**DMA接口组成：**

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\5-6-2.png" alt="image-20230506164213068" style="zoom:67%;" />

1.主存地址寄存器（AR）：主存中需要进行数据交换的地址，每交换一次数据，地址加1

2.字计数器（WC）：记录传送数据的字数。

3.数据缓冲寄存器（BR）

4.DMA控制逻辑

5.中断机构

6.设备地址寄存器（DAR）

**工作流程：**

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\5-6-9.png" alt="image-20230506164936680" style="zoom:67%;" />

1.预处理：

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\5-6-3.png" alt="image-20230506164520540" style="zoom:67%;" />

2.数据传送：

以数据块的方式传送。

数据输入流程：

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\5-6-4.png" alt="image-20230506164638918" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\5-6-5.png" alt="image-20230506164711443" style="zoom:67%;" />

数据输出流程：

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\5-6-6.png" alt="image-20230506164757826" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\5-6-7.png" alt="image-20230506164828226" style="zoom:67%;" />

3.后处理

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\5-6-8.png" alt="image-20230506164855299" style="zoom:67%;" />

**DMA接口与系统连接方式：**

链式与独立：

<img src="D:\RegularFile\CSLearning\1.计算机组成原理\image\5-6-10.png" alt="image-20230506165053623" style="zoom:67%;" />

# 第六章 计算机的运算方法





# 第七章 指令系统

## 机器指令

**机器指令：**指的就是一条机器语言的语句，一条机器语言做出相应的动作。

指令系统就是所有的机器指令的集合，反映了机器可以完成的功能。

**指令的格式：**操作码 + 地址码。

其中操作码指明了需要进行的操作类型，比如转移、加法等等。操作码分为定长和不定长。定长容易理解，不定长的话就需要采用扩展操作码技术，即通过更改地址码的长度，来增加操作码的长度。如下图

<img src=".\image\7-1-1.png" alt="image-20230504084100312" style="zoom:67%;" />

地址码表示操作数的地址，可以在主存、io设备或者寄存器中。包括有四地址（两个操作数、一个结果存放地址、下一条指令的地址）、三地址（可以通过CPU的PC寄存器实现下一条指令自动加1所以少一个地址）、二地址（结果存放在CPU寄存器中）、一地址（另一个操作数地址隐含在ACC中）、零地址（空操作、停机等等）。

注意不同地址书的指令访存次数不同。

**指令字长**就取决于操作码长度、地址码个数、地址码的长度。

## 操作数与操作类型

**操作数类型**可以是地址、数字、字符、逻辑数据（将n个01组合看作逻辑数）。

边界对准指的是多字节的数据（机器指令时01组合也可以看作数据）的地址要满足一定要求，比如机器指令可以为8（字节）、16（半字）、32（字）、64（双字）情况下，半字地址必须是2的整数倍、字地址时4的整数倍。不够长度补若干个0。

<img src=".\image\7-1-2.png" alt="image-20230504085234363" style="zoom:67%;" />

<img src=".\image\7-1-3.png" alt="image-20230504085424587" style="zoom:67%;" />

如果不对齐，有可能一个字地址（32位）存放在两个存储单元中（一个存储单元是32位）

**字节次序**有两种方式：低字节为低地址和高字节为低地址

<img src=".\image\7-1-4.png" alt="image-20230504085630028" style="zoom:67%;" />

**一些常见的操作类型。**

## 寻址方式

（从高级语言角度来说不需要了解指令寻址方式，但是一旦采用汇编语言编程，只有了解寻址方式才能正确编程）

寻址方式就是确定本次指令操作数的地址以及下一条指令的地址的方式。（指令和数据都存放在主存中）

**指令寻址：**顺序寻址就是PC寄存器自动加1，跳跃寻址通过转移指令实现（数据寻址中的直接寻址和相对寻址）

**数据寻址：指令的地址码通常不代表真实地址，记作形式地址A，真实地址为EA，真实地址由寻址方式和形式地址A共同确定。**

一地址指令格式：操作码 + 寻址特征 + 形式地址A

1.立即寻址：形式地址A就是操作数本身。

<img src=".\image\7-3-1.png" alt="image-20230504090305731" style="zoom:50%;" />

2.直接寻址：A就是EA

<img src=".\image\7-3-2.png" alt="image-20230504090345972" style="zoom:50%;" />

3.隐含寻址：不给出操作数地址，操作数的地址隐含在操作码或者某个寄存器中。这里的A没用。

<img src=".\image\7-3-3.png" alt="image-20230504090521378" style="zoom:50%;" />

4.间接寻址：一次间接：形式地址A指向的内存保存着真实地址EA（两次访存才能找到真正的操作数）

<img src=".\image\7-3-4.png" alt="image-20230504090709060" style="zoom: 50%;" />

5.寄存器寻址：地址码直接给出寄存器编号R

<img src=".\image\7-3-5.png" alt="image-20230504090820528" style="zoom:50%;" />

6.寄存器间接寻址：寄存器中存放的是操作数在主存中的地址，这样虽然是间接但是也只访存一次。

<img src=".\image\7-3-6.png" alt="image-20230504090931356" style="zoom:50%;" />

7.基址寻址：有效地址等于形式地址A与基址寄存器中的基地址（BR）相加。

<img src=".\image\7-3-7.png" alt="image-20230504091038631" style="zoom:67%;" />

隐式：专门的基址寄存器，使用时用户不需要指出基址寄存器。

显式：通用寄存器由用户指出是哪一个作为基址寄存器。

<img src=".\image\7-3-8.png" alt="image-20230504091528221" style="zoom:67%;" />

8.变址寻址：真实地址EA = 形式地址A + 变址寄存器（IX）

<img src=".\image\7-3-9.png" alt="image-20230504091640481" style="zoom:67%;" />

<img src=".\image\7-3-10.png" alt="image-20230504091802217" style="zoom: 67%;" />

<img src=".\image\7-3-11.png" alt="image-20230504091924585" style="zoom:67%;" />

9.相对寻址：有效地址EA = PC + A

操作数与指令有一段距离。

<img src=".\image\7-3-12.png" alt="image-20230504092018386" style="zoom:50%;" />

10.堆栈寻址：操作数地址总被隐含在栈顶指针sp指向的位置。

<img src=".\image\7-3-13.png" alt="image-20230504092256192" style="zoom:50%;" />

## RISC技术

相对于CISC（Complex Instruction Set Computer）来说的一个概念，RISC（Reduced Instruction Set Computer）尽可能采用20%的简单指令组合来实现那些不常用的80%的复杂指令。

# 第八章 CPU的结构和功能

## CPU的结构

**CPU的主要功能：**

<img src=".\image\8-1-1.png" alt="image-20230504093338655" style="zoom:67%;" />

**CPU的结构：**

<img src=".\image\8-1-2.png" alt="image-20230504093507246" style="zoom:67%;" />

<img src=".\image\8-1-3.png" alt="image-20230504093531096" style="zoom:67%;" />

**CPU的寄存器**大致可以分为两类：用户可见寄存器（可编程）和状态和控制寄存器。

**用户可见寄存器（执行机器指令可以访问的寄存器）：**

1.通用寄存器：可以用作需要功能。

2.数据寄存器：存放操作数。

3.地址寄存器：存放地址，也可是基址寻址、变址寻址的寄存器。

4.条件码寄存器

**控制和状态寄存器（控制CPU的操作或者运算）：**

1.MAR：存储器地址寄存器，用于存放哟啊被访问的存储单元的地址；

2.MDR：存储器数据寄存器，用于存放欲存入存储器或者最近从中读出的数；

3.PC：程序计数器，存放正在执行的指令的地址，通常可以自动增加形成下一条指令的地址；

4.IR：指令寄存器，存放当前欲执行的指令。

**控制单元CU在第九章介绍，中断系统在本章后面介绍。**

## 指令周期

指令周期指的是执行一条指令所需要的时间。取指、分析、执行。

<img src=".\image\8-2-1.png" alt="image-20230504094525106" style="zoom:67%;" />

不同指令其指令周期不相同。

<img src=".\image\8-2-2.png" alt="image-20230504094840038" style="zoom: 67%;" />

由于存在间接寻址方式，所以需要在取指阶段结束之后增加一个阶段；由于中断系统总是在指令周期的最后CPU查询是否需要处理中断，所以需要增加一个中断周期。

<img src=".\image\8-2-3.png" alt="image-20230504094913343" style="zoom:67%;" />

**指令周期的数据流（了解）：**

1.取指周期数据流：

<img src=".\image\8-2-4.png" alt="image-20230504095040657" style="zoom:67%;" />

2.间址周期数据流

<img src=".\image\8-2-5.png" alt="image-20230504095144334" style="zoom:67%;" />

<img src=".\image\8-2-6.png" alt="image-20230504095200563" style="zoom:67%;" />

3.执行周期数据流

由于不同指令操作不同，没有统一的数据流。

4.中断周期数据流

<img src=".\image\8-2-7.png" alt="image-20230504095259165" style="zoom:67%;" />

## 指令流水（提高处理机速度）

<img src=".\image\8-3-1.png" alt="image-20230504095539129" style="zoom:67%;" />

1.提高器件的性能越来越受到物理极限限制。

2.提高并行性：

<img src=".\image\8-3-2.png" alt="image-20230504095728486" style="zoom:67%;" />

**指令流水的原理：（理解）**

主要思想就是：如果指令的执行阶段不访存，那么就可以边执行边取下一条指令。

![image-20230504095910706](.\image\8-3-3.png)

实际上不可能完成加倍效率：1.执行时间 > 取指时间：因此取指要等待执行；2.遇到条件转移指令时下一条指令是不可知的。

但是仍可以猜测下一条指令，这样至少可以完成效率上的提高。

**指令六级流水（看看就可以）：**

<img src=".\image\8-3-4.png" alt="image-20230504100201000" style="zoom:67%;" />

<img src=".\image\8-3-5.png" alt="image-20230504100221822" style="zoom:67%;" />

**影响指令流水线性能的因素：**

1.结构因素：主要是硬件资源无法满足指令重叠执行的要求，比如存储器不支持两个或者多个访存操作同时进行。

解决方案一是可以把指令和数据分开存储，这样读指令不影响读数据；二是采用指令预取技术，将指令预先取到指令队列中，这要求访存周期很短，因此在指令执行时主存会有空闲时间。

2.数据因素：主要是流水线指令重叠操作影响读写顺序，比如需要写了之后再进行读。

解决方法一是后推法，即如果需要读修改过的内容必须等到修改之后才能读；二是采用定向技术（旁路技术、相关通路技术），直接把指令的执行结果（比如结果数）送到其他指令需要的地址。

<img src=".\image\8-3-6.png" alt="image-20230504100945482" style="zoom:67%;" />

<img src=".\image\8-3-7.png" alt="image-20230504101028271" style="zoom:67%;" />

<img src=".\image\8-3-8.png" alt="image-20230504101050375" style="zoom:67%;" />

3.控制因素：主要是转移指令破坏流水线性能。

<img src=".\image\8-3-9.png" alt="image-20230504101153202" style="zoom:67%;" />

​	<img src=".\image\8-3-10.png" alt="image-20230504101219792" style="zoom:67%;" />

**流水线性能：**吞吐率、加速比、效率

**流水线中的多发技术**

## 中断系统

中断系统需要解决的问题：

<img src=".\image\8-4-1.png" alt="image-20230504101409478" style="zoom:67%;" />

<img src=".\image\8-4-2.png" alt="image-20230504101429906" style="zoom:67%;" />

**中断请求标记：（回答中断源如何向CPU提出中断请求的问题**

使用中断请求触发器，记作INTR。不同中断源由对应不同的中断请求触发器。

<img src=".\image\8-4-3.png" alt="image-20230504101629486" style="zoom:67%;" />

可以分散到各个中断源处。

**中断判优逻辑：（回答中断系统如何确定优先响应那个中断源的请求）**

1，硬件实现：一种为链式排队器（比如第五章IO设备的排队），另一种链式排队器设在CPU内。

<img src=".\image\8-4-4.png" alt="image-20230504101908766" style="zoom:67%;" />

2.软件实现：通过编写查询程序

<img src=".\image\8-4-5.png" alt="image-20230504101939614" style="zoom:67%;" />

**中断服务程序入口地址寻找：**

1.硬件向量法：根据中断源的信号INTRi组成中断向量，再根据中断向量找到相应的程序入口。

<img src=".\image\8-4-6.png" alt="image-20230504103143897" style="zoom:67%;" />

2.软件查询法。

**中断相应：（回答什么条件、什么时候、如何响应中断）**

响应中断的条件：允许中断触发器和中断请求标记触发器都为1

响应中断的时间：CPU在执行周期的结束时刻统一向所有中断源发送查询信号。

（某些计算机如果执行周期很长可以在“查询断点”进行查询。

中断隐指令：进入中断周期之后需要完成1.保护程序断点（当前指令入栈或者保存到固定内存比如0地址）、寻找中断服务程序入口地址、关中断（不接受其它中断信号）的操作，这是由一条中断隐指令完成。

**保护现场和恢复现场：**

保护现场包括保护断点和保护CPU寄存器内容，前者由隐指令完成，后者在中断服务程序中由用户或者系统完成。

恢复现场是指中断返回前，将寄存器内容恢复到中断处理前的状态。

**中断屏蔽技术：**

主要用于多重中断。

多重中断是指中断嵌套。

多重中断的条件：1.前“开中断”；2.优先级高的中断源有权中断优先级低的中断。

屏蔽技术：

屏蔽触发器MASK能够与完成触发器D、中断请求触发器INTR共同决定中断源是否能够发出中断信号。（第五章IO中断中有讲）

多个屏蔽触发器组合就是一个屏蔽寄存器，里面的内容称为屏蔽字。

<img src=".\image\8-4-7.png" alt="image-20230504104418488" style="zoom:67%;" />

采用屏蔽技术能够改变处理优先级。

<img src=".\image\8-4-8.png" alt="image-20230504104516398" style="zoom:67%;" />

<img src=".\image\8-4-9.png" alt="image-20230504104543575" style="zoom:67%;" />

<img src=".\image\8-4-10.png" alt="image-20230504104601776" style="zoom:67%;" />

采用屏蔽技术的中断服务程序：

<img src=".\image\8-4-11.png" alt="image-20230504104653711" style="zoom:67%;" />

# 第九章 控制单元的功能

## 微操作命令的分析

**微操作**命令就是控制信号，也就是控制单元的主要功能：发出控制信号。

以四个寄存器为例介绍在不同指令周期（取指、间址、执行等）的一些微操作。

## 控制单元的功能

就是发出不同的控制信号（微操作序列）

举一个加法指令介绍在补使用CPU内部总线和使用CPU内部总线的情况下不同指令周期的微操作（控制信号）。

**多级时序系统：**机器周期：所有指令执行的一个基准时间，由于指令中对于内存操作的一类耗时比较长，一般作为基准时间。一个机器周期里面可能有多个微操作；时钟周期：等于节拍的概念，也就是一个微操作的基本时间，作为CPU的主频。多级时序系统就是由机器周期和节拍组成。

主频就是时钟周期，但是机器的运行速度并只不取决于主频，因为一条指令周期可能包含多个机器周期，一个机器周期包含多个时钟周期，与一个周期内能够进行多少微操作有关。

一条指令的执行过程实际上就是依次执行一个确定的微操作序列的过程。

最后，控制单元的每一个控制信号都是在指定机器周期内的指定T时刻发出的，也就是在每个节拍干一个微操作。







