# 规划

从2023.05.26起，复习计算机网络

概论：1天

物理层：1天

数据链路层：2~3天

网络层：4~5天

运输层：3~4天

应用层：5天

无线网络和移动网络：1~2天

预计20天左右。就是6月底看完

阅读时间：2023.05.26~2023.06.25（一个月左右）

总结下来就是对于每一层的任务以及常用的协议进行了了解。

# 第一章 概述

## 计算机网络作用

连通性：使得上网用户之间好像互相连接。

共享：指的是资源（信息、软件、硬件）等资源共享。

## 互联网

**计算机网络**（网络）由若干个结点和链路组成，结点可以是计算机、集线器、交换机、路由器等。

**互连网**是将网络通过路由器连接起来，即网络的网络。

（互联网就是最大的互连网）

互联网发展阶段：单个分组交换网后来变为多个分组交换网（互联网）、三级结构互联网（主干、地区、校园）、多层次ISP结构（由互联网服务提供者共同拥有）



## 互联网组成

由边缘部分和核心部分组成。

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\1-3-1.png" alt="image-20230527090457796" style="zoom:67%;" />

**边缘部分：**连接在互联网上的所有主机。两个主机通信指的是运行在两个主机上的进程之间相互通信。

（1）客户-服务器模式：两个进程，一个作为客户，一个作为服务器。

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\1-3-2.png" alt="image-20230527090711608" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\1-3-3.png" alt="image-20230527090732328" style="zoom:67%;" />

（2）对等连接方式：两台主机的进程通信时不区分客户进程和服务器进程。都可以下载对方存在硬盘中的数据。

**核心部分：**

核心部分最重要的是路由器，负责分组转发。

（1）电路交换：建立连接->通话（占用一条通信链路）->释放连接，**缺点**在于占用的通信链路大部分时间空闲，类似于计算机IO设备工作时CPU空闲。

（2）分组交换：将整块数据看作报文，将大报文划分成更小的包，加上控制信息之后作为一个分组发送。

路由器收到分组之后，先暂时存储一下（存储在内存中，而不是硬盘中，因而读取速度快），然后根据控制信息进行转发。

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\1-3-4.png" alt="image-20230527091402963" style="zoom:67%;" />

优点：

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\1-3-5.png" alt="image-20230527091438547" style="zoom: 80%;" />

电路交换、报文交换、分组交换对比：

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\1-3-6.png" alt="image-20230527091526256" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\1-3-7.png" alt="image-20230527091540814" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\1-3-8.png" alt="image-20230527091558327" style="zoom:67%;" />

## 计算机网络在我国的发展（略）

## 计算机网络的分类

按范围分类：广域网WAN、城域网MAN、局域网LAN、个人区域网PAN

按使用者：公用网、专用网



## 计算机网络性能

1.速率：信息量 / 时间，bit/s

2.带宽：最高速率

3.吞吐量：实际速率

4.时延：从一端到另一端所需时间

（1）发送时延：主机或者路由器发送数据帧所需要的时间。发生在机器内部的发送器中，比如网络适配器。

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\1-6-1.png" alt="image-20230527092021795" style="zoom:67%;" />

（2）传播时延：电磁波在信道中传输一定距离耗费的时间。

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\1-6-2.png" alt="image-20230527092158103" style="zoom:67%;" />

（3）处理时延：主机或者路由器收到分组花费一定时间处理。

（4）排队时延：进入路由器之后等待处理和等待发送的时间。

5.时延带宽积：

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\1-6-3.png" alt="image-20230527092357170" style="zoom:67%;" />

表示一段链路中可容纳的比特数，以比特为单位的链路长度。

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\1-6-4.png" alt="image-20230527092448499" style="zoom:67%;" />

6.往返时间RTT

7.利用率：有数据的信道的时间占据总时间的百分之多少。

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\1-6-5.png" alt="image-20230527092538996" style="zoom:67%;" />

利用率过高，时延会剧烈增大。

## 计算机网络体系结构

**协议：**为了完成某项任务和工作，必须遵守一定的规则，规则定义了交换数据的格式以及相关的同步问题。同步指的是在什么条件下应该发生什么样的时间，包含时序性。这些为网络中数据交换而制定的规则称为网络协议。

协议的组成：

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\1-7-1.png" alt="image-20230527092900356" style="zoom:67%;" />

**分层：**将大的工作层次化。每一层完成一定的工作，并向上提供服务接口。上层可以调用下层服务完成本层的任务。

各层的主要功能主要有：

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\1-7-2.png" alt="image-20230527093150641" style="zoom:67%;" />

**计算机网络体系结构**就是各层以及各层的协议的集合。

**五层协议体系结构：**

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\1-7-3.png" alt="image-20230527093217480" style="zoom:67%;" />

（1）应用层：通过应用进程之间的交互完成网络应用。定义**应用进程之间通信和交互的规则**。传送单位是报文。

（2）运输层：向两台主机进程之间的通信提供通用的数据传输服务。

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\1-7-4.png" alt="image-20230527093508771" style="zoom:67%;" />

（3）网络层：为分组交换网上的不同主机提供通信服务。传送单位是IP数据报。

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\1-7-5.png" alt="image-20230527093619992" style="zoom:67%;" />

（4）数据链路层：将IP数据包封装成帧，在链路上传送。

（5）物理层：传输单位是比特。

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\1-7-6.png" alt="image-20230527093821408" style="zoom:67%;" />



**TCP/IP体系结构：**

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\1-7-7.png" alt="image-20230527093936635" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\1-7-9.png" alt="image-20230527094034549" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\1-7-8.png" alt="image-20230527093956192" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\1-7-10.png" alt="image-20230527094059237" style="zoom:67%;" />

# 第二章 物理层

## 物理层基本概念

物理层考虑的是怎样才能在连接各种计算机的传输媒体上传输数据比特流，而不是指具体的传输媒体。

物理层的主要任务是确定与传输媒体的接口有关的一些特性：

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\2-1-1.png" alt="image-20230528084209981" style="zoom:67%;" />

**书上说具体的物理层协议很多，但是并没有介绍。下面就是一些通信概念和信道复用以及宽带接入技术。**

## 数据通信基础知识

数据通信模型：

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\2-2-1.png" alt="image-20230528084613920" style="zoom:67%;" />

通信的目的是传送消息，数据是消息的载体，信号是数据的电器或者电磁的表示。

信号可以分为模拟信号和数字信号。

码元表示状态。

信道的概念：单向通信、双向交替通信、双向同时通信

由源点发送的信号称为基带信号，基带信号由于含有频率低的成分不能直接传输，所以可以（1）基带调制（数字信号->数字信号，编码）；（2）带通调制（数字信号->模拟信号，载波）

常见编码方式

信道的极限容量：

奈氏准则：

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\2-2-2.png" alt="image-20230528085058468" style="zoom:67%;" />

香农公式：

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\2-2-4.png" alt="image-20230528085146327" style="zoom:67%;" />

## 物理层下面的传输媒体

分为导引型传输媒体和非导引型传输媒体

**导引型传输媒体：**

（1）双绞线：

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\2-2-5.png" alt="image-20230528085301321" style="zoom:67%;" />

无屏蔽双绞线UTP（Unshielded Twised Pair）、屏蔽双绞线STP（Shielded Twisted Pair）

（2）同轴电缆：

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\2-2-6.png" alt="image-20230528085513912" style="zoom:67%;" />

（3）光缆

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\2-2-7.png" alt="image-20230528085545892" style="zoom:67%;" />

**非导引型传输媒体：**

主要是无线电微波通信，包括地面接力微波通信和卫星通信。

## 信道复用技术

频分复用（每个用户使用不同频段）和时分复用（时间片轮转）：

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\2-4-1.png" alt="image-20230528085724354" style="zoom:67%;" />

统计时分复用：

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\2-4-2.png" alt="image-20230528085825745" style="zoom:67%;" />

波分复用：光的频分复用，不同波长对应不同用户。

码分复用：懒得看

## 数字传输系统

感觉就是统一标准

## 宽带接入技术（略）



# 第三章 数据链路层

数据链路层主要有两种信道：点对点信道（一对一）和广播信道（一对多）

局域网虽然是个网络，但是放在数据链路层讲解，因为数据链层考虑的是同一个局域网中多台主机传输分组的问题。而网络层则是考虑不同网络之间如何互连传送分组的问题。

链路层所处的位置：

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\3-1-1.png" alt="image-20230529085920582" style="zoom:80%;" />

从协议的层次上看路由器只有下面三层。

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\3-1-2.png" alt="image-20230529090020561" style="zoom:80%;" />

单从数据链路层来看，可以分为四段链路，**这四段链路可能采用不同的链路层协议。**

## 使用点对点信道的数据链路层

**链路**指的是从一个结点到相邻结点的一段物理线路，因此链路只是路径的一部分。

**数据链路**就是在物理链路上加上通信协议的硬件和软件。通常的方法是网络适配器（既有硬件又有软件）。包含了物理层和数据链路层的功能。

**帧**是数据链路层传输的数据单元，是将上层的IP数据报加上头部和尾部实现的。

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\3-1-3.png" alt="image-20230529090425006" style="zoom:80%;" />

数据链路层的主要功能就是把网络层交下来的数据封装成帧发送到链路上，以及把接收到的帧中的数据报取出发送给上层。

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\3-1-4.png" alt="image-20230529090544172" style="zoom:67%;" />

**1.封装成帧：**

在数据报前端和后端添加首部和尾部。首部和尾部起到控制和帧定界的作用。

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\3-1-5.png" alt="image-20230529090705151" style="zoom:80%;" />

帧定界符可以采用特殊的字符表示，比如SOH（start of header）和EOT（end of transmission）

**2.透明传输：**指的是无论什么比特的数据都能传输，因此对于数据中与定界符相同的需要特殊处理。

常采用的方法是：字节填充：

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\3-1-6.png" alt="image-20230529090934500" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\3-1-7.png" alt="image-20230529090951011" style="zoom:67%;" />

**3.差错控制：**主要是使用循环冗余校验码（CRC）在尾部加上帧检验序列FCS，检错**比特错误**（即某一位从0变成1或者从1变成0）

需要注意的是数据链路层关注的是比特错误，根据帧检验序列发现错误就抛弃；而对于帧丢失、帧重复、帧失序的传输错误并没有提供服务。

可靠传输指的就是发送什么就收到什么，所以需要解决后面的传输错误。数据链路层并不提供可靠传输服务。

## 点对点协议PPP

点对点协议通常是计算机与ISP通信所需要的数据链路层协议。

**ppp协议应该满足的需求：**

1.简单：接收方收到一个帧，进行CRC检验，出错就抛弃，没错就接收。

2.封装成帧

3.透明性

4.支持多种网络层协议

5.支持多种类型链路（串行的、并行的、同步的、异步的）

6.差错控制

7.检测连接状态

8.最大传送单元

9.网络地址协商

10.数据压缩协商

**ppp协议只支持全双工链路**

**ppp协议组成：**将IP数据报封装到串行链路的方法、建立配置测试链路连接的链路控制协议LCP、网络控制协议NCP

**帧格式：**

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\3-2-1.png" alt="image-20230529091934205" style="zoom:80%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\3-2-2.png" alt="image-20230529091953047" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\3-2-3.png" alt="image-20230529092014754" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\3-2-4.png" alt="image-20230529092033485" style="zoom:67%;" />

透明传输方法：对于异步传输使用字节填充：

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\3-2-5.png" alt="image-20230529092125865" style="zoom:67%;" />

对于同步传输使用零比特填充方法：

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\3-2-6.png" alt="image-20230529092215085" style="zoom:67%;" />

PPP协议的工作流程：

看书吧。

## 使用广播信道的数据链路层

广播信道就是可以进行一对多的通信。

### 局域网的数据链路层

局域网：网络为一个单位所有，地理范围和结点数收到限制。

局域网可以广播与拓扑结构有关：一台主机发送信号，所有主机都能接收到。

![image-20230530091948931](D:\RegularFile\CSLearning\3.计算机网络\image\3-3-1.png)

其中总线网以以太网最为出名。

局域网的工作层次跨越数据链路层和物理层。

由于局域网共享一个信道，所以需要考虑如何划分信道的使用。

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\3-3-2.png" alt="image-20230530092253843" style="zoom:67%;" />

以太网两个标准，一个是商业的，一个是IEEE802.3。后来局域网一直没有划分出一个统一标准，数据链路层划分为两个子层，逻辑链路控制LLC和MAC层媒体接入控制。

但是由于以太网后来占统治低位，所以LLC子层没用，只剩下MAC协议，即**媒体接入控制层**（Media  Access Control）

**适配器的作用：**实现了物理层和数据链路层

计算机与外接局域网通过适配器进行。

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\3-3-3.png" alt="image-20230530092847414" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\3-3-4.png" alt="image-20230530092955573" style="zoom:67%;" />

### CSMA/CD协议

总线的特点就是：当一台计算机发送数据时，总线上所有计算机都能检测到数据。

每台计算机的适配器都有一个与其他适配器不同的地址，当接收到数据时候，根据数据帧中的地址判断接收还是丢弃。只有当与自己的硬件ROM一致的时候才接收。

以太网两个特点是：1.采用无连接方式（由于总线上同一时间只能由一台计算机发送数据，因此需要就检测碰撞）；

2.使用曼彻斯特编码

**CSMA/CD协议：**

MA（Multiple Access）：多点接入，指的是总线型网络，多台主机接入

CS（Carrier Sense）：载波监听：不断检测信道。发送前检测是为了找到空闲时间发送，发送时检测时为了检测是否出现碰撞

CD（Collision Detection）：碰撞检测，如果几个站同时发送信号，那么信号叠加就会超过一定的阈值，认为发生碰撞。

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\3-3-5.png" alt="image-20230530093805015" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\3-3-6.png" alt="image-20230530093821829" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\3-3-7.png" alt="image-20230530093845342" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\3-3-8.png" alt="image-20230530093908340" style="zoom:67%;" />

因此每台主机在发送数据之后的一段时间内存在碰撞的可能。把这段时间称为争用期，最大为$2\tau$。即$\delta$为0的时候。

在争用期之后没有检测到碰撞才能认为不会发生碰撞。

**退避算法：**

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\3-3-9.png" alt="image-20230530094258625" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\3-3-10.png" alt="image-20230530094323270" style="zoom:67%;" />

**关于为什么存在最小帧长的概念：**

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\3-3-11.png" alt="image-20230530094419713" style="zoom:67%;" />

因为碰撞检测是边检测，所以如果发送数据时间<争用期，那么发送完了之后就无法检测到碰撞。

所以发送数据时间必须$\ge$争用期，也就是必须大于512bit。

**强化碰撞：**

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\3-3-12.png" alt="image-20230530094610731" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\3-3-13.png" alt="image-20230530094648295" style="zoom: 67%;" />

**协议归纳：**

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\3-3-14.png" alt="image-20230530094739695" style="zoom:67%;" />

### 使用集线器的星型拓扑

由总线型以太网变化成星型拓扑：中间采用集线器连接

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\3-3-15.png" alt="image-20230530094902226" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\3-3-16.png" alt="image-20230530094947741" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\3-3-17.png" alt="image-20230530095011240" style="zoom:67%;" />

### 以太网信达利用率

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\3-3-18.png" alt="image-20230530095117907" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\3-3-20.png" alt="image-20230530095226905" style="zoom:67%;" />

### 以太网的MAC层

**MAC地址：**硬件地址，固化在网络适配器的ROM中。但是实际上这个地址并不能标识位置，只能算是网络适配器的唯一标识。

硬件地址6字节（48位），前24位是由管理机构分配，后24位由厂家分配。

另外规定：I/G位：第一字节的最低位，表示Individual/Group，为0时表示单个站地址，为1表示组地址。

G/L位：第一字节最低的第二位，表示Global/Local，为0时表示全球管理，为1时表示本地管理。

所以实际上管理机构只分配22位。

**适配器：**

1.过滤功能：

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\3-3-21.png" alt="image-20230531085811507" style="zoom:67%;" />

2.混杂方式

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\3-3-22.png" alt="image-20230531085852550" style="zoom:67%;" />

**MAC帧的格式：**

介绍的是以太网V2标准（另一个标准是IEEE802.3）

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\3-3-23.png" alt="image-20230531085953644" style="zoom:67%;" />

1.帧格式字段说明：

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\3-3-24.png" alt="image-20230531090048510" style="zoom:67%;" />

2.如何判断数据位置：

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\3-3-25.png" alt="image-20230531090127655" style="zoom:67%;" />

3.存在填充字段如何如何求出数据字段长度：

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\3-3-26.png" alt="image-20230531090307578" style="zoom:67%;" />

4.前缀字段：

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\3-3-27.png" alt="image-20230531090358119" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\3-3-28.png" alt="image-20230531090433033" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\3-3-29.png" alt="image-20230531090522435" style="zoom:67%;" />

5.无效的MAC帧：

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\3-3-30.png" alt="image-20230531090554855" style="zoom:67%;" />

6.两个标准之间的差异：

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\3-3-31.png" alt="image-20230531090635195" style="zoom:67%;" />

## 扩展的以太网

主要目的是扩展以太网的覆盖范围

### 在物理层扩展以太网

主流的方法是使用光纤将主机连接到集线器上：

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\3-4-1.png" alt="image-20230531090807727" style="zoom: 67%;" />

多个集线器可以实现更大的以太网：

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\3-4-2.png" alt="image-20230531090918458" style="zoom:67%;" />

优点是不同系能够相互通信和覆盖范围变大。

缺点：1.三个碰撞域变成一个更大的碰撞域，总吞吐量变为一个系的吞吐量；2.三个系以太网技术必须相同（比如速率）

### 在数据数据链路层扩展以太网

最初是使用网桥：

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\3-4-3.png" alt="image-20230531091208191" style="zoom:67%;" />

目前主要使用**交换机**（相当于多接口网桥）

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\3-4-4.png" alt="image-20230531091512690" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\3-4-5.png" alt="image-20230531091628119" style="zoom:67%;" />

注意：交换机既可以直接转发，也可以暂存之后再转发。

**以太网自学习功能：**（本质就是学习一个帧的源地址和来源的接口）

看书例子。

缺点是可能会导致环路转发。

**总线以太网向星形以太网发展**

总线以太网使用CSMA/CD协议，以半双工方式工作；而星形以太网不使用共享总线，因此不用这个协议，以全双工方式工作。

但是帧的结构没有改变。

### 虚拟局域网

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\3-4-6.png" alt="image-20230531092039736" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\3-4-7.png" alt="image-20230531092058926" style="zoom:67%;" />

交换机在转发带有VLAN的帧时，只会向虚拟交换组内的计算机发送帧。

虚拟局域网协议：

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\3-4-8.png" alt="image-20230531092400433" style="zoom:67%;" />

## 高速以太网（略）

PPPoE：即PPP协议在以太网中传输。

用户到第一级交换机的带宽是独占的，但是一级交换机到上一级交换机带宽是许多用户共享的。

# 第四章 网络层

## 网络层提供的两种服务

面向连接的方式：需要先建立一条虚电路，类似于电信通话。

无连接方式：只提供无连接、尽最大努力交付的数据报服务。即发送分组时不需要建立连接，每一个分组独立发送。因此发送到分组可能会出现出错、丢失、重复、失序等错误。

对比：

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-1-1.png" alt="image-20230601094104149" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-1-2.png" alt="image-20230601094157909" style="zoom:67%;" />

## 网际协议IP

IP协议还有配套的三个协议：

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-2-1.png" alt="image-20230601094258324" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-2-2.png" alt="image-20230601094319792" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-2-3.png" alt="image-20230601094359792" style="zoom:67%;" />

### 虚拟互联网络

**网络总是存在异构性**，即不同的网络其内部结构、协议是不同的。

一些**中间设备**：

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-2-4.png" alt="image-20230601094543259" style="zoom:67%;" />

虚拟互联网络就是指逻辑上讲异构网络连接起来，使得在网络层看上去就是一个网络。

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-2-5.png" alt="image-20230601094646380" style="zoom:67%;" />

IP协议运作在网络层，如果网络都使用相同的IP协议，那么就会很方便：一个异构网络传输数据报的例子：

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-2-6.png" alt="image-20230601094824985" style="zoom:67%;" />

### 分类的IP地址

**ip地址表示方法：**

网络号 + 主机号，一共32位，4字节。网络号在互联网范围是唯一的，主机号在给定网路号范围下也是唯一的。

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-2-7.png" alt="image-20230601094940331" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-2-8.png" alt="image-20230601095044315" style="zoom:67%;" />

**常用的三种IP地址：**

关于网络号：只有A类地址需要去掉网络号全0（表示该网络）和全1（表示环回测试）

关于主机号：三类都需要去掉全0（本主机所在的网络）和全1（该网络下所有主机）

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-2-9.png" alt="image-20230601095322451" style="zoom:67%;" />

**IP地址的特点：**

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-2-10.png" alt="image-20230601095453380" style="zoom:67%;" />

三个局域网通过三个路由器相连的例子：

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-2-11.png" alt="image-20230601095646181" style="zoom:67%;" />

### IP地址与硬件地址

硬件地址是数据链路层和物理层使用的地址，位置在MAC帧首部

IP地址是网络层使用的地址，位置在IP数据报首部

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-2-12.png" alt="image-20230601095840424" style="zoom:67%;" />

数据报传送例子：

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-2-13.png" alt="image-20230601095913857" style="zoom:67%;" />

1.网络层传输数据报，其源IP地址和目的IP地址均不变化。

2.路由器转发分组时只关注网络号

3.数据链路层传输帧，其硬件地址会随着链路不同而发生变化。

### 地址解析协议ARP

解决问题是：已知IP地址，如何获得MAC地址

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-2-14.png" alt="image-20230601100158383" style="zoom:67%;" />

获取IP地址到硬件地址映射过程：假如主机A想要获得主机B的MAC地址。

1.主机A在本局域网上广播发送ARP请求分组（包括主机A的IP地址和MAC地址，以及B的IP地址）（主机A知道主机B的IP地址，根据网络号可以判断是在本网络上）

2.本局域网上所有主机都收到这个ARP请求分组；

3.只有主机B发现与自己的IP地址相符，于是从请求分组中找到A的IP地址和MAC地址，将自己的IP地址和MAC发送给主机A（注意请求分组是广播，响应分组是单播）

4.主机A收到相应分组更新ARP缓存

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-2-15.png" alt="image-20230601100622324" style="zoom:67%;" />

**生存时间：**每一个映射项目由设置一个生存时间，表示有效期。

**ARP解决的是统一局域网下的主机IP地址和硬件地址的映射关系**，无法解析另一个网络上的硬件地址。

因此需要借助路由器来完成，因为路由器即在网络1又在网络2，可以看作是两个网络的主机。

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-2-16.png" alt="image-20230601100951880" style="zoom:67%;" />

### IP数据报格式

以4字节为单位

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-2-21.png" alt="image-20230608204643114" style="zoom: 80%;" />

首部：固定字长20字节，首部后面是一些可选字段

数据部分。

**首部固定长度部分字段：**

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-2-22.png" alt="image-20230608204944362" style="zoom:67%;" />

**IP数据报如果长度过大就需要分片：**

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-2-23.png" alt="image-20230608205140506" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-2-24.png" alt="image-20230608205355186" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-2-25.png" alt="image-20230608205500424" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-2-26.png" alt="image-20230608205606770" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-2-27.png" alt="image-20230608205647806" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-2-28.png" alt="image-20230608205713332" style="zoom:67%;" />

**首部的可变部分：**略

### IP层转发流程

路由表只根据网络号转发分组。

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-2-17.png" alt="image-20230601101135581" style="zoom: 67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-2-18.png" alt="image-20230601101156677" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-2-19.png" alt="image-20230601101231775" style="zoom:67%;" />

特定主机路由（针对特定的目的主机设置一个路由）

默认路由

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-2-20.png" alt="image-20230601101356055" style="zoom:67%;" />

## 划分子网和构造超网

划分子网的原因：

1.二级网络利用率低，比如一个B类网络就有6万个主机。

2.给每一个网络划分一个网络号会使得路由表太大。

3.两级IP地址不够灵活，比如已经拥有一个网络号的公司想要开通一个新的网络，就必须申请一个新的网络号。（或许应该允许它在已经分配的网络号下划分自己的网络）

**子网划分：**

将原来的主机号划分为子网号和主机号，网络号不变，这样对外就是一个网络，但是在内部就可以有很多子网。

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-3-1.png" alt="image-20230602090851492" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-3-2.png" alt="image-20230602090923129" style="zoom:67%;" />

**子网掩码：**连接在这个网络的路由器如何查找属于哪个子网。

子网掩码目的是获得网络号+子网号，因此只需要把网络号部分和子网号部分设置为全1即可。

这样子网掩码与IP地址就可以得到网络号+子网号+后面都是0，而其它子网掩码与该IP地址不会得到正确的网络号+子网号+全0

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-3-3.png" alt="image-20230602091307830" style="zoom:67%;" />

对于没有划分子网的网络，默认子网掩码就是把前三个字节全设置为1。

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-3-4.png" alt="image-20230602091326686" style="zoom:67%;" />

路由表在交换信息时，必须将目的网络地址和它对应的子网掩码同时交换。

**对于同一个IP地址，使用不同的掩码可能会得到相同的网络地址，但是不同掩码下主机数不同。**

**使用子网时的分组转发：**路由表项：目的网络地址，子网掩码，下一跳地址

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-3-5.png" alt="image-20230602091539523" style="zoom:67%;" />

**构造超网：**

CIDR（Classless Inter-Domain Routing）无分类域间路由选择

网络前缀表示网络，后面的部分表示主机。

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-3-6.png" alt="image-20230602091935771" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-3-7.png" alt="image-20230602091959634" style="zoom:67%;" />

CIDR的掩码就是网络前缀的长度，也就是斜线后面的数字。

**CIDR仍然可以划分子网**

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-3-8.png" alt="image-20230602092111532" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-3-9.png" alt="image-20230602092141377" style="zoom:67%;" />

**路由聚合的概念：**可以将原来的多个网络地址融合成一个地址表示，路由器只需保存一个地址。

比如：对于前缀为13的CIDR，对于B类地址（16位），因此可以包含2^3次方个B类地址

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-3-10.png" alt="image-20230602092255920" style="zoom:67%;" />

**最长前缀匹配：**

路由表中每一项都是前缀和下一跳地址组成，可能会出现多个匹配结果

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-3-11.png" alt="image-20230602092745716" style="zoom:67%;" />

## 网际控制报文协议

ICMP（Internet Control Message Protocol）：允许主机发送或路由器报告差错情况和提供有关异常情况的报告。

格式：封装在IP数据报的数据部分发送

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-3-12.png" alt="image-20230602093148762" style="zoom:67%;" />

**种类：**

分为ICMP差错报告报文和ICMP询问报文。

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-3-13.png" alt="image-20230602093249252" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-3-14.png" alt="image-20230602093311853" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-3-15.png" alt="image-20230602093348954" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-3-16.png" alt="image-20230602093410744" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-3-17.png" alt="image-20230602093432460" style="zoom:67%;" />

ICMP报文应用：

1.ping命令：主机向目的IP地址发送四个ICMP回送请求报文（应用层直接使用网络层服务），目标IP的主机在收到之后返回ICMP回送回答报文。

2.traceroute（UNIX）和tracert（Windows）：跟踪一个分组从源点和终点的路径。

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-3-18.png" alt="image-20230602093746147" style="zoom:67%;" />

## 路由选择协议

路由选择协议是为了获取路由表中的路由，目前主要使用的是动态（自适应）路由选择。

**层次化的路由：**

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-5-1.png" alt="image-20230603092701842" style="zoom:67%;" />

### 内部网关协议RIP

RIP（Routing Information Protocol），路由信息协议，基于距离向量的路由选择协议。

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-5-2.png" alt="image-20230603092858062" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-5-3.png" alt="image-20230603092938451" style="zoom:67%;" />

**RIP协议特点：**

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-5-4.png" alt="image-20230603093120085" style="zoom:67%;" />

**距离向量算法：**

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-5-5.png" alt="image-20230603093208140" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-5-6.png" alt="image-20230603093309709" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-5-7.png" alt="image-20230603093327259" style="zoom:67%;" />

**RIP报文协议格式：**（使用UDP数据报）

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-5-8.png" alt="image-20230603093416136" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-5-9.png" alt="image-20230603093434682" style="zoom:67%;" />

**RIP协议的缺点：**

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-5-10.png" alt="image-20230603093521064" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-5-11.png" alt="image-20230603093544887" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-5-12.png" alt="image-20230603093616731" style="zoom:67%;" />

### 内部网关协议OSPF

OSPF（Open Shortest Path First)，开放最短路径优先

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-5-13.png" alt="image-20230603093754821" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-5-14.png" alt="image-20230603093833392" style="zoom:67%;" />

**自治系统内部再划分若干个子区域：**

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-5-15.png" alt="image-20230603093940308" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-5-16.png" alt="image-20230603094013299" style="zoom:67%;" />

**OSPF分组格式：**（使用IP数据报）

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-5-17.png" alt="image-20230603094111463" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-5-18.png" alt="image-20230603094126620" style="zoom:67%;" />

**OSPF分组类型：**

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-5-19.png" alt="image-20230603094208877" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-5-20.png" alt="image-20230603094249837" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-5-21.png" alt="image-20230603094329884" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-5-22.png" alt="image-20230603094349017" style="zoom:67%;" />

### 外部网关协议BGP

为什么在自治系统之间不能使用内部网关协议？

1.AS之间的路由选择困难：路由表项目很大，计算最优路径耗时；不同AS内部度量距离方式不同

2.AS之间路由选择需要遵循一定的策略（比如某个AS不想让另一个AS通过自己）

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-5-23.png" alt="image-20230603094739431" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-5-24.png" alt="image-20230603094811524" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-5-25.png" alt="image-20230603094836199" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-5-26.png" alt="image-20230603094854625" style="zoom:67%;" />

**BGP四种报文：**

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-5-27.png" alt="image-20230603095005791" style="zoom:67%;" />

BGP报文格式：

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-5-28.png" alt="image-20230603095034689" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-5-29.png" alt="image-20230603095055483" style="zoom:67%;" />

### 路由器构成

**路由器结构：**

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-5-30.png" alt="image-20230603095129724" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-5-31.png" alt="image-20230603095158249" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-5-32.png" alt="image-20230603095223088" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-5-33.png" alt="image-20230603095318738" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-5-34.png" alt="image-20230603095346090" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-5-35.png" alt="image-20230603095409978" style="zoom:67%;" />

**分组结构的发展：**

书

## IPv6

### IPv6格式

IPv6将数据报改称为分组。

变化：

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-6-1.png" alt="image-20230608210105264" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-6-2.png" alt="image-20230608210205701" style="zoom:67%;" />

**基本首部：**

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-6-3.png" alt="image-20230608210229620" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-6-4.png" alt="image-20230608210249760" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-6-5.png" alt="image-20230608210346886" style="zoom:67%;" />

**扩展首部：**

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-6-6.png" alt="image-20230608210425345" style="zoom:67%;" />

### IPv6地址

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-6-7.png" alt="image-20230610084343050" style="zoom:67%;" />

IPv6一共128位，采用冒号十六进制的方法，每16位的值用一个十六进制表示：

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-6-8.png" alt="image-20230610084517144" style="zoom:67%;" />

**冒号十六进制还包括以下两个技术：**

1.零压缩：一连串连续的零可以压缩为一对冒号。

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-6-9.png" alt="image-20230610084703962" style="zoom:67%;" />

2.可结合点分十进制（点分十进制是每8位为一个十进制整数表示）

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-6-10.png" alt="image-20230610084838154" style="zoom:67%;" />

**地址分类：**

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-6-11.png" alt="image-20230610084936789" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-6-12.png" alt="image-20230610085023575" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-6-13.png" alt="image-20230610085038020" style="zoom:67%;" />

### 从IPv4向IPv6过渡

1.双协议栈：

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-6-14.png" alt="image-20230610085143709" style="zoom:67%;" />

2.隧道技术：就是把IPv6分组作为IPv4数据报的数据部分

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-6-15.png" alt="image-20230610085234840" style="zoom:67%;" />

### ICMPv6

略

## IP多播

需要从一个源点发送数据报到许多个终点，即一对多的通信。

比如软件更新、交互式会议等。

例如：一个视频服务器要想90台主机发送视频节目，如果采用单播就需要发送90个副本：

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-7-1.png" alt="image-20230610085534951" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-7-2.png" alt="image-20230610085636268" style="zoom:67%;" />

**多播IP地址：**

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-7-3.png" alt="image-20230610085818465" style="zoom:67%;" />

### 局域网硬件多播

多播IP地址一一映射到MAC地址？

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-7-4.png" alt="image-20230610085945681" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-7-5.png" alt="image-20230610090024631" style="zoom:67%;" />

### 网际组管理协议IGMP和多播路由选择协议

**1.IP多播需要两种协议：**

IGMP：网际组管理协议主要是在本地局域网上确定是否有某个多播组成员。

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-7-7.png" alt="image-20230610090351443" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-7-6.png" alt="image-20230610090304398" style="zoom:67%;" />

多播路由选择协议规定网络与网络之间路由器如何协作工作。

但是这种路由选择协议比较复杂，书上举例说明：

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-7-8.png" alt="image-20230610090632251" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-7-9.png" alt="image-20230610090722536" style="zoom:67%;" />

**2.网际组管理协议**

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-7-10.png" alt="image-20230610090816254" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-7-11.png" alt="image-20230610090833127" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-7-12.png" alt="image-20230610090933754" style="zoom:67%;" />

**3.多播路由选择协议：**

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-7-13.png" alt="image-20230610091013672" style="zoom:67%;" />

**常用的三种方法：**

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-7-14.png" alt="image-20230610091101626" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-7-15.png" alt="image-20230610091119175" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-7-16.png" alt="image-20230610091222538" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-7-17.png" alt="image-20230610091243125" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-7-18.png" alt="image-20230610091300994" style="zoom:67%;" />

### 总结

关于多播目前还没有统一的网络协议标准，书上给的是总体设计的一些思想。

## 虚拟专用网VPN和网络地址转换NAT

**虚拟专用网：**

专用网：一个机构内部组成的网络，仅使用在本机构内部有效的IP地址（本地地址），而不需要全球的唯一地址。

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-8-1.png" alt="image-20230610091632268" style="zoom:67%;" />

虚拟专用网：

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-8-2.png" alt="image-20230610091808664" style="zoom: 67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-8-3.png" alt="image-20230610091908946" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-8-4.png" alt="image-20230610091947804" style="zoom:67%;" />

**网络地址转换NAT**

专用网内部已经分配到了本地地址，但是又想和互联网通信。

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-8-5.png" alt="image-20230610092116566" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-8-6.png" alt="image-20230610092130630" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-8-7.png" alt="image-20230610092219555" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-8-8.png" alt="image-20230610092247662" style="zoom:67%;" />

加上端口号的NAT：

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-8-9.png" alt="image-20230610092336149" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-8-10.png" alt="image-20230610092405049" style="zoom:67%;" />





## 多协议标记交换MPLS

多协议指的就是上层可以使用多种协议。

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-9-1.png" alt="image-20230611085840151" style="zoom:67%;" />

作为一种IP增强协议。

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-9-2.png" alt="image-20230611090005816" style="zoom:67%;" />

**基本原理：**

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-9-3.png" alt="image-20230611090110452" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-9-.png" alt="image-20230611090152404" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-9-4.png" alt="image-20230611090257347" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-9-5.png" alt="image-20230611090501847" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-9-6.png" alt="image-20230611090528109" style="zoom:67%;" />

**转发等价类：**

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-9-7.png" alt="image-20230611090642211" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-9-8.png" alt="image-20230611090729782" style="zoom:67%;" />

**格式：**

把IP数据报封装成帧之前增加MPLS首部。

长度为4字节：

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\4-9-9.png" alt="image-20230611090854767" style="zoom:67%;" />

# 第五章 运输层

## 运输层协议概述

### 进程之间的通信

IP协议负责将数据报在两台主机之间进行传送，而实际上进行通信的是两台主机上的两个进程，于是就需要运输层协议将IP数据报发送给正确的进程。

复用：指的是一台主机上的多个进程使用同一个运输层协议。

分用：指的是运输层协议将数据报交付给不同的进程。

### 运输层两个协议

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-1-1.png" alt="image-20230611091439852" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-1-2.png" alt="image-20230611091500953" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-1-3.png" alt="image-20230611091523168" style="zoom:67%;" />

### 运输层端口号

即复用和分用需要标识进程，这样运输层协议才能知道由哪个进程发送，并且交付给哪个进程。

协议端口号：只要把数据报交给主机的某个端口，接下来由TCP或者UDP完成。（即将数据报交付给占用这个端口的进程）

端口号只具有本地意义，用于标志本计算机应用层中各个进程和运输层交互时的接口。

因此，两个进程如果想要通信，不仅需要知道IP地址，还需要知道对方的端口号。

**端口号分类：**16位

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-1-4.png" alt="image-20230611092005709" style="zoom:67%;" />

## 用户数据报协议UDP

**UDP特点：**

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-2-·.png" alt="image-20230611092111161" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-2-2.png" alt="image-20230611092140148" style="zoom:67%;" />

**首部格式：**

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-2-3.png" alt="image-20230611092214070" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-2-4.png" alt="image-20230611092245347" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-2-5.png" alt="image-20230611092316131" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-2-6.png" alt="image-20230611092354310" style="zoom:67%;" />

反码运算就是
0+0 = 0
0+1 = 1+0 = 0
1+1=0且进1

如果最高位进1，那么最低位再加1

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-2-7.png" alt="image-20230611092534177" style="zoom:67%;" />

## 传输控制协议TCP概述

### TCP主要特点

1.面向连接

2.每一条TCP连接只能有两个端点，因此是一对一的服务

3.提供可靠传输，即无差错、不丢失、不重复、按序到达

4.全双工通信

5.面向字节流：指的是将数据看作字节流，一次组成多长的报文发送取决于当前窗口值和网络拥塞程度。

### TCP的连接

TCP连接的两个端点是套接字

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-3-1.png" alt="image-20230616090644263" style="zoom:67%;" />

## 可靠传输的原理

### 停止等待协议

就是每发送完一个分组就停止，等待接收方发过来的确认信号。

**1.无差错情况：**无差错就如下图a所示，A发送完一个分组就等待来自B的确认分组之后再发送下一个分组

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-3-2.png" alt="image-20230616090831354" style="zoom:67%;" />

**2.出现差错：**如果A发送到分组丢失，那么B就收不到来自A的分组，也就不会发送一个确认分组。
A采用的策略是超时重传，即为每一个分组设置一个计时器，如果超过计时器仍没有收到确认信号，就重新发送一次。
两个问题：（1）A发送完一个分组之后暂存这个分组，等到收到确认之后再丢弃；（2）计时器设置为多少合适，应该比往返时间长一些，后面小节有介绍。

**3.确认丢失和确认迟到**
指的是B发送到确认分组丢失或者迟到。

如果B确认分组丢失，那么A就会在超时之后重传之前的分组，此时B采取两个动作：1.丢弃重传的分组（因为之前之前已经收到了）；2.向A发送确认分组。

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-3-3.png" alt="image-20230617091531077" style="zoom:67%;" />

如果B的确认分组迟到，即A会受到重复的确认分组，那么A不会对这个重复的确认分组处理。

通过上述的停止等待协议，就可是实现在不可靠的网络上进行可靠传输。这种可靠协议也成为自动重传协议ARQ（Automatic Repeat reQuest）

**4.信道利用率**

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-3-4.png" alt="image-20230617091835209" style="zoom:67%;" />

利用率主要取决于RTT，当RTT很大时，利用率很低。

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-3-5.png" alt="image-20230617091940061" style="zoom:67%;" />

### 连续ARQ协议

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-3-6.png" alt="image-20230617092038467" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-3-7.png" alt="image-20230617092103561" style="zoom:67%;" />

## TCP报文段的首部格式

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-5-1.png" alt="image-20230617092204115" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-5-2.png" alt="image-20230617092230464" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-5-3.png" alt="image-20230617092250796" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-5-4.png" alt="image-20230617092347398" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-5-5.png" alt="image-20230617092420677" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-5-6.png" alt="image-20230617092444499" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-5-7.png" alt="image-20230617092534877" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-5-8.png" alt="image-20230617093654281" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-5-9.png" alt="image-20230617093756988" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-5-10.png" alt="image-20230617093854513" style="zoom: 67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-5-11.png" alt="image-20230617093948550" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-5-12.png" alt="image-20230617094046425" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-5-13.png" alt="image-20230617094226960" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-5-14.png" alt="image-20230617094333844" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-5-15.png" alt="image-20230617094355038" style="zoom:67%;" />

## TCP可靠传输的实现

### 以字节为单位的滑动窗口

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-5-16.png" alt="image-20230617094524610" style="zoom:67%;" />

**发送窗口：**

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-5-17.png" alt="image-20230617094733134" style="zoom:67%;" />

发送窗口内的字节：允许发送到序号。

发送窗口后沿：表示已经发送并且受到确认的序号。发送窗口前沿：不允许发送的序号。

发送窗口后沿：可以前移（收到新的确认）或者不动（没有收到新的确认）

发送窗口前沿：可以前移（收到了新的确认），也有可能不动（没有收到确认，并且对方通知的窗口大小不败你；收到了新的确认但是窗口变小了）

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-5-18.png" alt="image-20230617095309718" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-5-19.png" alt="image-20230617095328497" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-5-20.png" alt="image-20230617095420931" style="zoom:67%;" />



<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-5-21.png" alt="image-20230617095452124" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-5-22.png" alt="image-20230617095511239" style="zoom:67%;" />



<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-5-23.png" alt="image-20230617095555421" style="zoom:67%;" />



**窗口与缓存的关系：**

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-5-24.png" alt="image-20230617095704633" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-5-25.png" alt="image-20230617095751278" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-5-26.png" alt="image-20230617095818135" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-5-27.png" alt="image-20230617095906624" style="zoom:67%;" />

### 超时重传时间的选择

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-5-28.png" alt="image-20230617100022557" style="zoom:67%;" />

**RTT往返时间：**

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-5-29.png" alt="image-20230617100120025" style="zoom:67%;" />

**RTO超时重传时间：**

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-5-30.png" alt="image-20230617100156220" style="zoom:67%;" />

**存在的问题：**

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-5-31.png" alt="image-20230617100308433" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-5-32.png" alt="image-20230617100353459" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-5-33.png" alt="image-20230617100410647" style="zoom:67%;" />

### 选择确认SACK

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-5-34.png" alt="image-20230617100508439" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-5-35.png" alt="image-20230617100523233" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-5-36.png" alt="image-20230617100613430" style="zoom:67%;" />

## TCP流量控制

### 利用滑动窗口实现流量控制

流量控制就是让发送方的发送速率不要太快，要让接收方来得及处理。

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-5-37.png" alt="image-20230618084629466" style="zoom:67%;" />

即让发送方的发送窗口不能超过接收方的给出的窗口值。

**特殊情况：**

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-5-38.png" alt="image-20230618084821368" style="zoom: 67%;" />

### TCP传输效率

阅读

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-5-39.png" alt="image-20230618085030629" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-5-40.png" alt="image-20230618085124771" style="zoom: 80%;" />

## TCP拥塞控制

拥塞指的就是对于资源的需求大于可用资源

拥塞不能通过简单的对局部进行修改而得到解决。（比如增加路由器缓存、增加处理速度）

拥塞控制指的是防止过多的数据进入到网络中，让网络中的路由器和链路不至于过载。流量控制指的是点对点的通信量的控制。

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-8-1.png" alt="image-20230618090216779" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-8-2.png" alt="image-20230618090314012" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-8-3.png" alt="image-20230618090344543" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-8-4.png" alt="image-20230618090411832" style="zoom:67%;" />

### TCP拥塞控制方法

四种：慢开始、拥塞避免、快重传、快恢复

拥塞控制是基于窗口的控制，即发送方需要维持一个拥塞窗口，让自己的发送窗口等于拥塞窗口。

判断网络拥塞的依据就是出现了超时。

**慢开始：**刚开始逐渐增大窗口

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-8-5.png" alt="image-20230618090837567" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-8-6.png" alt="image-20230618090952305" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-8-7.png" alt="image-20230618091131637" style="zoom:67%;" />

**拥塞避免：**

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-8-8.png" alt="image-20230618091249136" style="zoom:67%;" />





<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-8-9.png" alt="image-20230618091456971" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-8-10.png" alt="image-20230618091549493" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-8-11.png" alt="image-20230618091715091" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-8-12.png" alt="image-20230618091836035" style="zoom:80%;" />



**总结：**

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-8-13.png" alt="image-20230618091914121" style="zoom:67%;" />

**拥塞窗口和接收方给定的窗口值共同决定发送方发送窗口大小：**

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-8-14.png" alt="image-20230618092053962" style="zoom:67%;" />

### 主动队列管理AQM

不是等待路由器缓冲队列满了之后才被动丢弃分组，而是预先采取措施丢弃一定的分组。

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-8-15.png" alt="image-20230618092329647" style="zoom: 67%;" />

## TCP的运输连接管理

运输连接三个阶段：连接建立、数据传送、连接释放

采用C/S模式。

### TCP连接建立

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-9-1.png" alt="image-20230618092523210" style="zoom: 67%;" />

交换三个TCP报文段。

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-9-2.png" alt="image-20230618092655308" style="zoom:67%;" />

### TCP连接释放

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-9-3.png" alt="image-20230618092801405" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-9-4.png" alt="image-20230618092817528" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-9-5.png" alt="image-20230618092858922" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-9-6.png" alt="image-20230618092925966" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\5-9-7.png" alt="image-20230618093008157" style="zoom:67%;" />

A多等待2MSL时间：1.确保A的确认分组能够到达B；2.防止出现“已经失效的连接请求报文段”。（A第一次发送连接请求报文段时，这个报文段在网络中滞留了很久；于是A重发连接请求报文段，正常与B通信之后释放连接；但是之后这个滞留的报文段到达了B，B于是尝试回应A，但是此时A并没有想与B通信，因此A不予理会。于是B就一直等待A，浪费资源）

TCP有限状态机

![image-20230618093547323](D:\RegularFile\CSLearning\3.计算机网络\image\5-9-8.png)

# 第六章 应用层

应用层协议是为不同的应用进程提供网络服务。
每个应用层协议都是为了解决某一类应用问题，这类应用问题的解决需要位于不同主机中的多个应用进程之间的通信和协同工作完成。

## 域名系统DNS

域名系统就是互联网的命名系统，即给出不同机器名字到IP地址的转换。
理论上说可以在整个互联网中设置一个域名服务器，里面装有连在互联网上所有计算机的名字和IP地址的对应，但是由于互联网机器太多，一台服务器负荷太重。
因此互联网的域名服务器是分布式的。

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\6-1-1.png" alt="image-20230620092630768" style="zoom:67%;" />

### 域名结构

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\6-1-2.png" alt="image-20230620092820554" style="zoom:67%;" />

常见的域名：

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\6-1-3.png" alt="image-20230620092919100" style="zoom:67%;" />

### 域名服务器

DNS服务器管辖的范围以一个区为单位，保存这个区内所有主机域名到IP地址的映射。

区是域的子集。

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\6-1-4.png" alt="image-20230620093256484" style="zoom:67%;" />

1.根域名服务器：知道所有**顶级域名服务器**的域名和IP。

2.顶级域名服务器：负责管理在该顶级域名服务器下的二级域名

3.权限域名服务器：管理一个区的域名

4.本地域名服务器：离用户最近的域名服务器。

查询方式：

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\6-1-5.png" alt="image-20230620093606278" style="zoom:67%;" />

可以采用一些缓存技术，保存上次DNS的结果。

## 文件传送协议FTP

特点就是如果想要存取一个文件，就必须获取整个文件的副本。想要修改文件，就必须把文件下载的本地，修改之后再上传替代原来的文件。

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\6-2-1.png" alt="image-20230620093909147" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\6-2-2.png" alt="image-20230620093956957" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\6-2-3.png" alt="image-20230620094018063" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\6-2-4.png" alt="image-20230620094150528" style="zoom:67%;" />

网络文件系统NFS：允许进程打开一个远地文件，直接在远地进行修改。

简单文件传送协议TFTP：使用UDP

## 远程终端协议TELNET

使用TCP

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\6-2-5.png" alt="image-20230620094347550" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\6-2-6.png" alt="image-20230620094406036" style="zoom:67%;" />

## 万维网WWW

万维网把大量信息（文档、音频等资源）存储在互联网的不同主机上（提供资源的主机可以看作是服务器），通过链接可以从一个文档跳转到另一个文档。

超文本就是包含指向其他文档链接的文档。

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\6-4-1.png" alt="image-20230625092245083" style="zoom:67%;" />

1.万维网使用URL(统一资源定位符)标识互联网上的文档

2.使用超文本传输协议（HTTP）实现互联网上的各种链接

3.使用超文本标记语言HTML设计互联网文档

### 统一资源定位符

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\6-4-2.png" alt="image-20230625092605664" style="zoom:67%;" />

主机通常指的是域名，通过域名服务获得对应的IP地址。

协议通常使用的是http协议，默认端口是80，所以可以省略。

协议和主机部分不区分大小写。

### HTTP协议过程

**HTTP协议工作流程：**

使用TCP建立连接

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\6-4-3.png" alt="image-20230625092949795" style="zoom:67%;" />

然后使用HTTP报文交互：

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\6-4-4.png" alt="image-20230625093021638" style="zoom:67%;" />

这里引入的概念是持续连接，即万维网服务器在发送响应之后仍然维持一段时间这个连接，使得同一个用户能够继续使用这条连接进行交互。

另外就是采用流水线和非流水线的形式。

**代理服务器**

将曾经访问过的内存暂时保存，如果需要该代理服务器就可以将内容发送给请求方，而不用再去向服务器请求。

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\6-4-5.png" alt="image-20230625093321249" style="zoom:67%;" />

**HTTP报文结构**

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\6-4-6.png" alt="image-20230625093404513" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\6-4-7.png" alt="image-20230625093438386" style="zoom:67%;" />

HTTP请求报文：

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\6-4-8.png" alt="image-20230625093514022" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\6-4-9.png" alt="image-20230625093531178" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\6-4-10.png" alt="image-20230625093557126" style="zoom:67%;" />

HTTP响应报文

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\6-4-11.png" alt="image-20230625093631544" style="zoom:67%;" />

**在服务器上保存用户信息：**

COOKIE

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\6-4-12.png" alt="image-20230625093820613" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\6-4-13.png" alt="image-20230625093849930" style="zoom:67%;" />

### 万维网文档

HTML语言

XML语言：

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\6-4-14.png" alt="image-20230625094009028" style="zoom: 67%;" />

XHTML：

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\6-4-15.png" alt="image-20230625094035148" style="zoom:67%;" />

CSS

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\6-4-16.png" alt="image-20230625094101622" style="zoom:67%;" />

**动态万维网文档：**

静态万维网文档创建完成之后就保存在万维网服务器中，无法更改内容。

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\6-4-17.png" alt="image-20230625094241660" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\6-4-18.png" alt="image-20230625094311648" style="zoom:67%;" />

CGI：通用网关接口，定义动态文档应该如何创建。

**活动万维网文档**

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\6-4-19.png" alt="image-20230625094440906" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\6-4-20.png" alt="image-20230625094507545" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\6-4-21.png" alt="image-20230625094531627" style="zoom:67%;" />



### 万维网信息检索系统（略）

### 博客和微博（略）

## 电子邮件

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\6-5-1.png" alt="image-20230625094759146" style="zoom:67%;" />

邮件服务器要有两种协议，使用SMTP在发件人用户代理和服务器以及服务器与服务器之间传送数据，使用pop3在接收方代理和服务器之间传送数据。

需要注意的是，邮件不会在中间服务器落地，只会在发送方和接收方邮件服务器之间传送。

SMTP客户将邮件push给邮件服务器，而POP3客户使用pull将邮件从邮寄服务器中拉给自己。

电子邮件地址：

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\6-5-2.png" alt="image-20230625095248718" style="zoom:67%;" />

### SMTP协议

### POP3和IMAP



### 基于互联网的电子邮件

即在浏览器和邮件服务器之间是HTTP协议，在邮件服务器内部还是SMTP协议。

### 通用互联网邮件扩充MIME



## 动态主机配置协议DHCP

动态为协议软件配置参数，比如：

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\6-6-1.png" alt="image-20230625095627854" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\6-6-2.png" alt="image-20230625095711234" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\6-6-3.png" alt="image-20230625095734845" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\6-6-4.png" alt="image-20230625095750281" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\6-6-5.png" alt="image-20230625095825636" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\6-6-6.png" alt="image-20230625095839345" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\6-6-7.png" alt="image-20230625095853480" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\6-6-8.png" alt="image-20230625095912335" style="zoom:80%;" />

## 简单网络管理协议SNMP（略）

## 应用进程跨越网络的通信

系统调用：在应用程序和操作系统之间传递控制权。

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\6-8-1.png" alt="image-20230625100137485" style="zoom:67%;" />

这种系统调用接口也可称为应用编程接口，应用进程只需使用标准的系统调用接口函数就能得到操作系统的服务。

而目前TCP/IP协议软件已经是现在操作系统中，因此应用程序想要使用协议通信可以通过系统调用接口来请求服务。

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\6-8-2.png" alt="image-20230625100424195" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\6-8-3.png" alt="image-20230625100439502" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\6-8-4.png" alt="image-20230625100519959" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\6-8-5.png" alt="image-20230625100554637" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\6-8-6.png" alt="image-20230625100620505" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\6-8-7.png" alt="image-20230625100635987" style="zoom:67%;" />

### 以TCP为例介绍几种系统调用

1.连接建立阶段

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\6-8-8.png" alt="image-20230625100755320" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\6-8-9.png" alt="image-20230625100813013" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\6-8-10.png" alt="image-20230625100827110" style="zoom:67%;" />

2.数据传送阶段

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\6-8-11.png" alt="image-20230625100847847" style="zoom:67%;" />

3.连接释放阶段

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\6-8-12.png" alt="image-20230625100912147" style="zoom:67%;" />

<img src="D:\RegularFile\CSLearning\3.计算机网络\image\6-8-13.png" alt="image-20230625100929556" style="zoom:67%;" />



## P2P应用（略）



# 第九章 无线网络和移动网络（待定）































